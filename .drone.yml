workspace:
  base: /home/circleci
  path: laravel/boilerplate

pipeline:
  build:
    image: notnoopci/php:7.1-browsers
    volumes:
      - /tmp/composer-cache:/home/circleci/.composer/cache/
    commands:
      - cp .env.dusk .env
      - composer install --ignore-platform-reqs
      - php artisan key:generate
      - touch database/database.sqlite
      - ./vendor/bin/phpunit
      - ./vendor/laravel/dusk/bin/chromedriver-linux &
      - php artisan serve &
      - php artisan dusk
